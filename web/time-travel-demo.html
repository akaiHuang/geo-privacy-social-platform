<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™‚å…‰å›æº¯åŠŸèƒ½æ¸¬è©¦ - BroBro</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
      background: linear-gradient(135deg, #1a1a24 0%, #2d2d3f 100%);
      color: #E5E7EB;
      min-height: 100vh;
      overflow-x: hidden;
    }

    .demo-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    .demo-header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInDown 0.6s ease;
    }

    .demo-header h1 {
      font-size: 2.5rem;
      background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.5rem;
    }

    .demo-header p {
      color: #9CA3AF;
      font-size: 1.1rem;
    }

    .demo-content {
      background: rgba(26, 26, 36, 0.8);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(167, 139, 250, 0.3);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      animation: fadeInUp 0.6s ease;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: rgba(167, 139, 250, 0.1);
      border: 1px solid rgba(167, 139, 250, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      text-align: center;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      border-color: rgba(167, 139, 250, 0.5);
      box-shadow: 0 8px 24px rgba(167, 139, 250, 0.2);
    }

    .stat-icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #9CA3AF;
      margin-bottom: 0.5rem;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #A78BFA;
    }

    .mock-posts {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1rem;
      margin-top: 2rem;
      max-height: 400px;
      overflow-y: auto;
      padding: 1rem;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 12px;
    }

    .mock-post-card {
      background: rgba(167, 139, 250, 0.1);
      border: 1px solid rgba(167, 139, 250, 0.2);
      border-radius: 12px;
      padding: 1rem;
      transition: all 0.3s ease;
      animation: fadeIn 0.4s ease;
    }

    .mock-post-card:hover {
      transform: scale(1.05);
      border-color: rgba(167, 139, 250, 0.5);
    }

    .post-time {
      font-size: 0.85rem;
      color: #A78BFA;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .post-content {
      font-size: 0.9rem;
      color: #E5E7EB;
      line-height: 1.4;
    }

    .post-location {
      font-size: 0.8rem;
      color: #9CA3AF;
      margin-top: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    .controls-info {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.2);
      border-radius: 16px;
      padding: 1.5rem;
      margin-top: 2rem;
    }

    .controls-info h3 {
      color: #3B82F6;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .controls-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .control-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      background: rgba(59, 130, 246, 0.05);
      border-radius: 8px;
    }

    .control-icon {
      font-size: 1.5rem;
    }

    .control-text {
      font-size: 0.9rem;
      color: #E5E7EB;
    }

    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #9CA3AF;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ç¢ºä¿å³å´æœ‰ç©ºé–“çµ¦æ™‚é–“æ§åˆ¶å™¨ */
    body {
      padding-right: 0px;
    }

    .demo-container {
      margin-right: 120px;
    }
  </style>
</head>
<body>
  <div class="demo-container">
    <div class="demo-header">
      <h1>â° æ™‚å…‰å›æº¯åŠŸèƒ½æ¸¬è©¦</h1>
      <p>é«”é©—åœ°åœ–æ™‚é–“è»¸å›æ”¾åŠŸèƒ½</p>
    </div>

    <div class="demo-content">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">ğŸ•</div>
          <div class="stat-label">ç•¶å‰æ™‚é–“æ§½</div>
          <div class="stat-value" id="current-time-slot">--:--</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ“</div>
          <div class="stat-label">è²¼æ–‡æ•¸é‡</div>
          <div class="stat-value" id="post-count">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">â±ï¸</div>
          <div class="stat-label">ç›¸å°æ™‚é–“</div>
          <div class="stat-value" id="relative-time" style="font-size: 1.5rem;">å³æ™‚</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ğŸ¯</div>
          <div class="stat-label">æ™‚é–“æ§½ç¸½æ•¸</div>
          <div class="stat-value" id="total-slots">48</div>
        </div>
      </div>

      <div id="posts-container">
        <div class="empty-state">
          <div class="empty-state-icon">ğŸ”</div>
          <p>ä½¿ç”¨ä¸‹æ–¹æ™‚é–“è»¸æŸ¥çœ‹ä¸åŒæ™‚æ®µçš„æ¨¡æ“¬è²¼æ–‡</p>
        </div>
      </div>
    </div>

    <div class="demo-content controls-info">
      <h3>ğŸ® æ“ä½œèªªæ˜</h3>
      <div class="controls-list">
        <div class="control-item">
          <span class="control-icon">â®</span>
          <span class="control-text">ä¸Šä¸€å€‹æ™‚æ®µï¼ˆ-30åˆ†é˜ï¼‰</span>
        </div>
        <div class="control-item">
          <span class="control-icon">â–¶ï¸</span>
          <span class="control-text">æ’­æ”¾/æš«åœè‡ªå‹•å›æ”¾</span>
        </div>
        <div class="control-item">
          <span class="control-icon">â­</span>
          <span class="control-text">ä¸‹ä¸€å€‹æ™‚æ®µï¼ˆ+30åˆ†é˜ï¼‰</span>
        </div>
        <div class="control-item">
          <span class="control-icon">ğŸšï¸</span>
          <span class="control-text">æ‹–æ›³æ»‘æ¡¿å¿«é€Ÿè·³è½‰</span>
        </div>
        <div class="control-item">
          <span class="control-icon">âš¡</span>
          <span class="control-text">èª¿æ•´æ’­æ”¾é€Ÿåº¦ï¼ˆ1x/2x/4xï¼‰</span>
        </div>
        <div class="control-item">
          <span class="control-icon">ğŸ•</span>
          <span class="control-text">è·³å›ç¾åœ¨æ™‚é–“</span>
        </div>
      </div>
    </div>
  </div>

  <!-- TimeSlider çµ„ä»¶çš„å®¹å™¨ -->
  <div id="time-slider-root"></div>

  <!-- å¼•å…¥ React å’Œç›¸é—œä¾è³´ -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <script type="module">
    // æ¨¡æ“¬ç”Ÿæˆæ¸¬è©¦æ•¸æ“š
    function generateMockPosts(timeSlot) {
      const [date, time] = timeSlot.split(' ');
      const [hours, minutes] = time.split(':');
      const hour = parseInt(hours);
      
      // æ ¹æ“šæ™‚æ®µç”Ÿæˆä¸åŒæ•¸é‡çš„è²¼æ–‡ï¼ˆæ¨¡æ“¬æ´»èºåº¦è®ŠåŒ–ï¼‰
      let postCount;
      if (hour >= 7 && hour <= 9) postCount = Math.floor(Math.random() * 15) + 10; // æ—©æ™¨é«˜å³°
      else if (hour >= 12 && hour <= 14) postCount = Math.floor(Math.random() * 20) + 15; // åˆé¤é«˜å³°
      else if (hour >= 18 && hour <= 22) postCount = Math.floor(Math.random() * 25) + 20; // æ™šé–“é«˜å³°
      else if (hour >= 0 && hour <= 6) postCount = Math.floor(Math.random() * 5) + 1; // æ·±å¤œ
      else postCount = Math.floor(Math.random() * 10) + 5; // å…¶ä»–æ™‚æ®µ
      
      const posts = [];
      const locations = [
        'å°åŒ—å¸‚å¤§å®‰å€', 'å°åŒ—å¸‚ä¿¡ç¾©å€', 'æ–°åŒ—å¸‚æ¿æ©‹å€', 'æ¡ƒåœ’å¸‚ä¸­å£¢å€',
        'å°ä¸­å¸‚è¥¿å±¯å€', 'å°å—å¸‚æ±å€', 'é«˜é›„å¸‚å‰é®å€', 'æ–°ç«¹å¸‚æ±å€'
      ];
      
      const contents = [
        'ä»Šå¤©å¤©æ°£çœŸå¥½ï¼â˜€ï¸',
        'å‰›åƒå®Œè¶…å¥½åƒçš„ç¾é£Ÿ ğŸœ',
        'é€™å€‹åœ°æ–¹é¢¨æ™¯çœŸç¾ ğŸï¸',
        'é€±æœ«æ„‰å¿«å¤§å®¶ï¼ğŸ‰',
        'ä¸‹ç­äº†ï¼Œæº–å‚™å›å®¶ ğŸ ',
        'æ—©å®‰ï¼æ–°çš„ä¸€å¤©é–‹å§‹äº† â˜•',
        'ä»Šå¤©é‹å‹•å®Œè¶…èˆ’æœ ğŸ’ª',
        'ç™¼ç¾ä¸€å®¶æ–°é–‹çš„å’–å•¡å»³ â˜•',
      ];
      
      for (let i = 0; i < postCount; i++) {
        posts.push({
          id: `${timeSlot}-${i}`,
          time: timeSlot,
          content: contents[Math.floor(Math.random() * contents.length)],
          location: locations[Math.floor(Math.random() * locations.length)]
        });
      }
      
      return posts;
    }

    // æ›´æ–°é¡¯ç¤º
    function updateDisplay(timeSlot, posts) {
      // æ›´æ–°çµ±è¨ˆ
      document.getElementById('current-time-slot').textContent = timeSlot.split(' ')[1];
      document.getElementById('post-count').textContent = posts.length;
      
      // è¨ˆç®—ç›¸å°æ™‚é–“
      const now = new Date();
      const [date, time] = timeSlot.split(' ');
      const [year, month, day] = date.split('-');
      const [hours, minutes] = time.split(':');
      const slotDate = new Date(year, month - 1, day, hours, minutes);
      const diffHours = (now - slotDate) / (1000 * 60 * 60);
      
      let relativeTime;
      if (diffHours < 0.1) relativeTime = 'å³æ™‚';
      else if (diffHours < 1) relativeTime = `${Math.round(diffHours * 60)}åˆ†å‰`;
      else relativeTime = `${diffHours.toFixed(1)}å°æ™‚å‰`;
      
      document.getElementById('relative-time').textContent = relativeTime;
      
      // æ›´æ–°è²¼æ–‡åˆ—è¡¨
      const container = document.getElementById('posts-container');
      
      if (posts.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ˜´</div>
            <p>æ­¤æ™‚æ®µæ²’æœ‰è²¼æ–‡</p>
          </div>
        `;
      } else {
        container.innerHTML = `
          <div class="mock-posts">
            ${posts.map(post => `
              <div class="mock-post-card">
                <div class="post-time">${post.time.split(' ')[1]}</div>
                <div class="post-content">${post.content}</div>
                <div class="post-location">ğŸ“ ${post.location}</div>
              </div>
            `).join('')}
          </div>
        `;
      }
    }

    // æ¨¡æ“¬ TimeSlider åŠŸèƒ½
    window.handleTimeChange = function(timeSlot) {
      console.log('Time changed to:', timeSlot);
      const posts = generateMockPosts(timeSlot);
      updateDisplay(timeSlot, posts);
    };

    // åˆå§‹åŒ–é¡¯ç¤º
    const now = new Date();
    const currentTimeSlot = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${now.getMinutes() >= 30 ? '30' : '00'}`;
    updateDisplay(currentTimeSlot, generateMockPosts(currentTimeSlot));
  </script>

  <style>
    /* å‚ç›´æ™‚é–“åˆ»åº¦æ§åˆ¶å™¨ - æ¥µç°¡è¨­è¨ˆ */
    .time-slider-container {
      position: fixed;
      right: 2rem;
      top: 50%;
      transform: translateY(-50%);
      width: 60px;
      height: 85vh;
      max-height: 750px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      align-items: center;
      pointer-events: none;
    }

    /* éš±è—åŸæœ‰çš„æ™‚é–“é¡¯ç¤ºå’ŒæŒ‰éˆ• */
    .time-display {
      display: none;
    }

    .control-btn {
      display: none;
    }

    /* å‚ç›´æ»‘æ¡¿å®¹å™¨ */
    .slider-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      width: 100%;
      position: relative;
      padding: 0 20px;
      pointer-events: auto;
    }

    /* å‚ç›´æ»‘æ¡¿ - å®Œå…¨é€æ˜ */
    .time-slider-wrapper {
      flex: 1;
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    .time-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 40px;
      height: 100%;
      background: transparent;
      outline: none;
      cursor: pointer;
      position: absolute;
      z-index: 10;
      writing-mode: bt-lr;
    }

    .time-slider::-webkit-slider-runnable-track {
      background: transparent;
    }

    .time-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 40px;
      height: 40px;
      background: transparent;
      cursor: pointer;
      border: none;
    }

    .time-slider::-moz-range-track {
      background: transparent;
    }

    .time-slider::-moz-range-thumb {
      width: 40px;
      height: 40px;
      background: transparent;
      cursor: pointer;
      border: none;
    }

    /* æ™‚é–“åˆ»åº¦æ¨™è¨˜å®¹å™¨ */
    .time-marks {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 0;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      pointer-events: none;
      z-index: 1;
    }

    /* åˆ»åº¦ç·šåŸºç¤æ¨£å¼ */
    .time-mark {
      position: relative;
      height: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .time-mark::before {
      content: '';
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.7);
      filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.3));
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    /* ç´°ç·šï¼ˆæ¯å€‹æ™‚é–“é»ï¼‰- æ¯ 30 åˆ†é˜ */
    .time-mark.thin::before {
      width: 12px;
      height: 1.5px;
    }

    /* ç²—ç·šï¼ˆæ¯4å€‹ç´°ç·šå¾Œï¼‰- æ¯ 2 å°æ™‚ */
    .time-mark.thick::before {
      width: 20px;
      height: 2.5px;
      background: rgba(255, 255, 255, 0.9);
      filter: drop-shadow(0 0 6px rgba(255, 255, 255, 0.4));
    }

    /* æ™‚é–“æ¨™ç±¤ - å®Œå…¨éš±è— */
    .time-mark-label {
      display: none;
    }

    /* ç•¶å‰æ™‚é–“é¡¯ç¤ºæ¡† - è·Ÿéš¨æ»‘é¼  */
    .current-time-bubble {
      position: fixed;
      background: rgba(255, 255, 255, 0.95);
      color: #000;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      pointer-events: none;
      opacity: 0;
      transform: scale(0.8);
      transition: opacity 0.2s ease, transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 10000;
      white-space: nowrap;
    }

    .current-time-bubble.visible {
      opacity: 1;
      transform: scale(1);
    }

    /* ç•¶å‰ä½ç½®æŒ‡ç¤ºå™¨ */
    .current-position-indicator {
      position: absolute;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 12px;
      height: 12px;
      background: linear-gradient(135deg, #A78BFA 0%, #8B5CF6 100%);
      border-radius: 50%;
      box-shadow: 0 0 0 3px rgba(167, 139, 250, 0.3),
                  0 2px 8px rgba(139, 92, 246, 0.5);
      pointer-events: none;
      z-index: 20;
      transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .time-slider:active ~ .current-position-indicator {
      transform: translate(-50%, -50%) scale(1.3);
      box-shadow: 0 0 0 5px rgba(167, 139, 250, 0.4),
                  0 4px 16px rgba(139, 92, 246, 0.7);
    }

    /* é€²åº¦æŒ‡ç¤ºå™¨ */
    .progress-indicator {
      display: none;
    }

    /* ç§»å‹•ç«¯é©é… */
    @media (max-width: 768px) {
      .time-slider-container {
        right: 1rem;
        width: 50px;
      }

      .slider-controls {
        padding: 0 15px;
      }

      .time-mark.thin::before {
        width: 10px;
      }

      .time-mark.thick::before {
        width: 16px;
      }

      .current-time-bubble {
        font-size: 0.8rem;
        padding: 0.4rem 0.6rem;
      }
    }

    /* å°è¢å¹•é©é… */
    @media (max-width: 480px) {
      body {
        padding-right: 70px;
      }

      .demo-container {
        margin-right: 70px;
      }

      .time-slider-container {
        right: 0.5rem;
        width: 45px;
        max-height: 650px;
      }

      .slider-controls {
        padding: 0 12px;
      }
    }
  </style>

  <!-- ç´” JavaScript å¯¦ç¾çš„ TimeSlider -->
  <script>
    (function() {
      const maxHistoryHours = 24;
      let selectedIndex = 0;
      let timeSlots = [];
      let isPlaying = false;
      let playbackSpeed = 1;
      let playInterval = null;

      // ç”Ÿæˆæ™‚é–“æ§½
      function generateTimeSlots() {
        const slots = [];
        const now = new Date();
        const totalSlots = maxHistoryHours * 2;

        for (let i = totalSlots; i >= 0; i--) {
          const time = new Date(now.getTime() - i * 30 * 60 * 1000);
          const year = time.getFullYear();
          const month = String(time.getMonth() + 1).padStart(2, '0');
          const day = String(time.getDate()).padStart(2, '0');
          const hours = String(time.getHours()).padStart(2, '0');
          const minutes = time.getMinutes() >= 30 ? '30' : '00';
          slots.push(`${year}-${month}-${day} ${hours}:${minutes}`);
        }

        return slots;
      }

      function formatDisplay(timeSlot) {
        const [date, time] = timeSlot.split(' ');
        const [year, month, day] = date.split('-');
        return `${month}/${day} ${time}`;
      }

      function getHoursAgo(timeSlot) {
        const [date, time] = timeSlot.split(' ');
        const [year, month, day] = date.split('-');
        const [hours, minutes] = time.split(':');
        const slotDate = new Date(year, month - 1, day, hours, minutes);
        const now = new Date();
        return (now - slotDate) / (1000 * 60 * 60);
      }

      function updateDisplay() {
        const timeSlot = timeSlots[selectedIndex];
        const hoursAgo = getHoursAgo(timeSlot);
        const isCurrentTime = selectedIndex === timeSlots.length - 1;

        document.getElementById('current-time-display').textContent = formatDisplay(timeSlot);
        
        const timeAgoEl = document.getElementById('time-ago-display');
        if (isCurrentTime) {
          timeAgoEl.innerHTML = '<span class="current-badge">â— å³æ™‚</span>';
        } else {
          const text = hoursAgo < 1 
            ? `(${Math.round(hoursAgo * 60)} åˆ†é˜å‰)`
            : `(${hoursAgo.toFixed(1)} å°æ™‚å‰)`;
          timeAgoEl.innerHTML = `<span class="time-ago">${text}</span>`;
        }

        document.getElementById('time-slider-input').value = selectedIndex;
        document.getElementById('progress-text').textContent = `${selectedIndex + 1} / ${timeSlots.length}`;

        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        document.getElementById('btn-prev').disabled = selectedIndex === 0;
        document.getElementById('btn-next').disabled = isCurrentTime;
        document.getElementById('btn-now').disabled = isCurrentTime;

        // è§¸ç™¼å›èª¿
        if (window.handleTimeChange) {
          window.handleTimeChange(timeSlot);
        }
      }

      function startPlayback() {
        if (playInterval) clearInterval(playInterval);
        playInterval = setInterval(() => {
          if (selectedIndex >= timeSlots.length - 1) {
            stopPlayback();
          } else {
            selectedIndex++;
            updateDisplay();
          }
        }, 1000 / playbackSpeed);
      }

      function stopPlayback() {
        isPlaying = false;
        if (playInterval) {
          clearInterval(playInterval);
          playInterval = null;
        }
        document.getElementById('btn-play').innerHTML = `
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8 5v14l11-7z"/>
          </svg>
        `;
        const speedBtn = document.getElementById('btn-speed');
        if (speedBtn) speedBtn.remove();
      }

      function init() {
        timeSlots = generateTimeSlots();
        selectedIndex = timeSlots.length - 1;

        const container = document.getElementById('time-slider-root');
        container.innerHTML = `
          <div class="time-slider-container">
            <div class="slider-controls">
              <div class="time-slider-wrapper" id="slider-wrapper">
                <div class="time-marks" id="time-marks"></div>
                <div class="current-position-indicator" id="current-indicator"></div>
                <div class="current-time-bubble" id="time-bubble">
                  <span id="bubble-time">14:30</span>
                </div>
                <input type="range" min="0" max="${timeSlots.length - 1}" value="${selectedIndex}" 
                       class="time-slider" id="time-slider-input" orient="vertical">
              </div>
            </div>

            <div class="progress-indicator">
              <div class="progress-text" id="progress-text"></div>
            </div>
          </div>
        `;

        // ç”Ÿæˆæ™‚é–“åˆ»åº¦ - æ¯å€‹æ™‚é–“æ§½ä¸€å€‹åˆ»åº¦
        const marksContainer = document.getElementById('time-marks');
        marksContainer.innerHTML = '';
        
        // å¾æœ€æ–°åˆ°æœ€èˆŠæ’åˆ—ï¼ˆä¸Šåˆ°ä¸‹ï¼‰
        const reversedSlots = [...timeSlots].reverse();
        
        reversedSlots.forEach((slot, displayIndex) => {
          const actualIndex = timeSlots.length - 1 - displayIndex;
          const mark = document.createElement('div');
          const isThick = actualIndex % 4 === 0; // æ¯4å€‹ç´°ç·šå¾Œä¸€å€‹ç²—ç·š
          mark.className = `time-mark ${isThick ? 'thick' : 'thin'}`;
          mark.dataset.index = actualIndex;
          marksContainer.appendChild(mark);
        });

        // ç²å–å…ƒç´ 
        const slider = document.getElementById('time-slider-input');
        const sliderWrapper = document.getElementById('slider-wrapper');
        const bubble = document.getElementById('time-bubble');
        const indicator = document.getElementById('current-indicator');
        let isDragging = false;

        // æ›´æ–°ä½ç½®å’Œé¡¯ç¤º
        function updatePositionAndDisplay() {
          const timeSlot = timeSlots[selectedIndex];
          
          // è¨ˆç®—ä½ç½®ï¼ˆå¾åº•éƒ¨å¾€ä¸Šï¼Œ0 åœ¨åº•éƒ¨ï¼Œmax åœ¨é ‚éƒ¨ï¼‰
          const percentage = selectedIndex / (timeSlots.length - 1);
          const wrapperHeight = sliderWrapper.offsetHeight;
          const top = wrapperHeight * (1 - percentage);
          
          console.log('ğŸ“ Position update:', {
            selectedIndex,
            timeSlot,
            percentage: percentage.toFixed(2),
            wrapperHeight,
            calculatedTop: top.toFixed(2),
            formula: `${wrapperHeight} * (1 - ${percentage.toFixed(2)}) = ${top.toFixed(2)}`
          });
          
          // æ›´æ–°æŒ‡ç¤ºå™¨ä½ç½®
          if (indicator) {
            indicator.style.top = `${top}px`;
            console.log('ğŸŸ£ Indicator updated:', indicator.style.top);
          }
          
          // æ›´æ–°æ™‚é–“æ³¡æ³¡å…§å®¹
          if (bubble) {
            document.getElementById('bubble-time').textContent = formatDisplay(timeSlot);
          }
          
          // æ›´æ–°ç²¾éˆæ•ˆæœ
          if (isDragging) {
            updateGenieEffect(selectedIndex);
          }
          
          // è§¸ç™¼å›èª¿æ›´æ–°è²¼æ–‡é¡¯ç¤º
          if (window.handleTimeChange) {
            window.handleTimeChange(timeSlot);
          }
        }

        // æ»‘æ¡¿è¼¸å…¥äº‹ä»¶ - ç¦ç”¨ï¼Œæ”¹ç”¨æ‰‹å‹•è¨ˆç®—
        // slider.addEventListener('input', function(e) {
        //   selectedIndex = parseInt(this.value);
        //   console.log('ğŸ”µ Slider input:', {
        //     sliderValue: this.value,
        //     selectedIndex,
        //     totalSlots: timeSlots.length,
        //     percentage: selectedIndex / (timeSlots.length - 1)
        //   });
        //   updatePositionAndDisplay();
        // });

        // æŒ‰ä¸‹æ™‚é¡¯ç¤ºæ™‚é–“æ³¡æ³¡å’Œç²¾éˆæ•ˆæœ
        slider.addEventListener('mousedown', function(e) {
          const rect = this.getBoundingClientRect();
          const clickY = e.clientY - rect.top; // é»æ“Šä½ç½®è·é›¢é ‚éƒ¨çš„è·é›¢
          const sliderHeight = rect.height;
          
          // æ‰‹å‹•è¨ˆç®—æ‡‰è©²å°æ‡‰çš„ç´¢å¼•ï¼ˆå¾ä¸Šåˆ°ä¸‹ï¼š0 åˆ° maxï¼‰
          const percentage = clickY / sliderHeight;
          const calculatedIndex = Math.round(percentage * (timeSlots.length - 1));
          
          console.log('ğŸ–±ï¸ Mouse down:', {
            clientY: e.clientY,
            rectTop: rect.top,
            rectBottom: rect.bottom,
            clickY,
            sliderHeight,
            percentage: percentage.toFixed(3),
            calculatedIndex,
            currentValue: this.value,
            shouldBe: timeSlots.length - 1 - calculatedIndex // åè½‰ï¼ˆå¾åº•éƒ¨ç®—èµ·ï¼‰
          });
          
          // æ‰‹å‹•è¨­ç½®æ»‘æ¡¿å€¼ï¼ˆå¾åº•éƒ¨å¾€ä¸Šï¼šmax åœ¨é ‚éƒ¨ï¼Œ0 åœ¨åº•éƒ¨ï¼‰
          const correctedIndex = timeSlots.length - 1 - calculatedIndex;
          this.value = correctedIndex;
          selectedIndex = correctedIndex;
          
          isDragging = true;
          bubble.classList.add('visible');
          updatePositionAndDisplay();
          updateMousePosition(e);
        });

        slider.addEventListener('touchstart', function(e) {
          const rect = this.getBoundingClientRect();
          const touch = e.touches[0];
          const clickY = touch.clientY - rect.top;
          const sliderHeight = rect.height;
          const percentage = clickY / sliderHeight;
          const calculatedIndex = Math.round(percentage * (timeSlots.length - 1));
          const correctedIndex = timeSlots.length - 1 - calculatedIndex;
          
          console.log('ğŸ‘† Touch start:', {
            clientY: touch.clientY,
            clickY,
            percentage: percentage.toFixed(3),
            correctedIndex
          });
          
          this.value = correctedIndex;
          selectedIndex = correctedIndex;
          
          isDragging = true;
          bubble.classList.add('visible');
          updatePositionAndDisplay();
          updateMousePosition(touch);
        });

        // æ»‘é¼ /è§¸æ§ç§»å‹•æ™‚æ›´æ–°æ³¡æ³¡ä½ç½®
        function updateMousePosition(e) {
          if (isDragging && bubble) {
            // è¨­ç½®æ³¡æ³¡ä½ç½®åœ¨æ»‘é¼ æ—é‚Š
            const x = e.clientX || e.pageX;
            const y = e.clientY || e.pageY;
            
            console.log('ğŸ“ Mouse position:', { x, y });
            
            // æ³¡æ³¡é¡¯ç¤ºåœ¨æ»‘é¼ å·¦å´
            bubble.style.left = `${x - 80}px`;
            bubble.style.top = `${y}px`;
            bubble.style.transform = 'translateY(-50%)';
          }
        }

        slider.addEventListener('mousemove', function(e) {
          if (isDragging) {
            // æ‰‹å‹•è¨ˆç®—æ‹–å‹•ä½ç½®å°æ‡‰çš„ç´¢å¼•
            const rect = this.getBoundingClientRect();
            const dragY = e.clientY - rect.top;
            const sliderHeight = rect.height;
            const percentage = Math.max(0, Math.min(1, dragY / sliderHeight));
            const calculatedIndex = Math.round(percentage * (timeSlots.length - 1));
            const correctedIndex = timeSlots.length - 1 - calculatedIndex;
            
            console.log('ğŸ–±ï¸ Mouse move during drag:', {
              clientY: e.clientY,
              dragY,
              percentage: percentage.toFixed(3),
              calculatedIndex,
              correctedIndex,
              oldIndex: selectedIndex
            });
            
            // æ›´æ–°ç´¢å¼•å’Œæ»‘æ¡¿å€¼
            this.value = correctedIndex;
            selectedIndex = correctedIndex;
            updatePositionAndDisplay();
            updateMousePosition(e);
          }
        });

        slider.addEventListener('touchmove', function(e) {
          if (isDragging && e.touches[0]) {
            // æ‰‹å‹•è¨ˆç®—è§¸æ§æ‹–å‹•ä½ç½®
            const rect = this.getBoundingClientRect();
            const touch = e.touches[0];
            const dragY = touch.clientY - rect.top;
            const sliderHeight = rect.height;
            const percentage = Math.max(0, Math.min(1, dragY / sliderHeight));
            const calculatedIndex = Math.round(percentage * (timeSlots.length - 1));
            const correctedIndex = timeSlots.length - 1 - calculatedIndex;
            
            this.value = correctedIndex;
            selectedIndex = correctedIndex;
            updatePositionAndDisplay();
            updateMousePosition(touch);
          }
        });

        // é»æ“Šäº‹ä»¶ï¼ˆè·³è½‰åˆ°æŒ‡å®šä½ç½®ï¼‰
        slider.addEventListener('click', function(e) {
          console.log('ğŸ¯ Click event:', {
            clientY: e.clientY,
            offsetY: e.offsetY,
            sliderRect: this.getBoundingClientRect(),
            sliderHeight: this.offsetHeight,
            sliderValue: this.value,
            calculatedIndex: 'æ‡‰è©²æ ¹æ“šé»æ“Šä½ç½®è¨ˆç®—'
          });
        });

        // æ”¾é–‹æ™‚éš±è—æ™‚é–“æ³¡æ³¡
        function handleRelease(e) {
          console.log('ğŸ–±ï¸ Mouse/Touch released');
          if (isDragging) {
            isDragging = false;
            bubble.classList.remove('visible');
            resetGenieEffect(); // ç«‹å³é‡ç½®ç²¾éˆæ•ˆæœ
          }
        }

        slider.addEventListener('mouseup', handleRelease);
        slider.addEventListener('touchend', handleRelease);
        document.addEventListener('mouseup', handleRelease);
        document.addEventListener('touchend', handleRelease);

        // åˆå§‹åŒ–é¡¯ç¤º
        updatePositionAndDisplay();
      }

      // Genie ç²¾éˆæ•ˆæœ - macOS Dock é¢¨æ ¼
      function updateGenieEffect(currentIndex) {
        const marks = document.querySelectorAll('.time-mark');
        
        marks.forEach((mark) => {
          const markIndex = parseInt(mark.dataset.index);
          const distance = Math.abs(currentIndex - markIndex);
          
          // è·é›¢è¶Šè¿‘ï¼Œæ”¾å¤§å€æ•¸è¶Šå¤§
          let scale = 1;
          
          if (distance === 0) {
            scale = 3.0;
          } else if (distance <= 1) {
            scale = 2.4;
          } else if (distance <= 2) {
            scale = 2.0;
          } else if (distance <= 3) {
            scale = 1.6;
          } else if (distance <= 5) {
            scale = 1.3;
          } else if (distance <= 8) {
            scale = 1.1;
          }
          
          mark.style.transform = `scaleX(${scale})`;
        });
      }

      // é‡ç½®ç²¾éˆæ•ˆæœ
      function resetGenieEffect() {
        const marks = document.querySelectorAll('.time-mark');
        marks.forEach((mark) => {
          mark.style.transform = 'scaleX(1)';
        });
      }

      // é é¢è¼‰å…¥å¾Œåˆå§‹åŒ–
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
  </script>
</body>
</html>
